<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        div {
            position: absolute;
            padding: 0px;
            margin: 0px;
        }
        body {height: 100%}
    </style>
    <script type="module">
        // Input objekt för att kontrollera värden
        let inputs = document.querySelectorAll("input");
        const startHastighet = 0.5;
        const skepp = [];
        const oSkott = [];
        const skott = [];
        const keyNames = []
        const numberOfPlayers = 2;
        const players = [];
        const colors = ["pink", "lawngreen"];
        keyNames[0] = ["6","4","8","5"];
        keyNames[1] = ["d","a","w","s"];
        let bothComingFromRight = false;
        let bothComingFromLeft = false;
        let bothComingFromTop = false;
        let bothComingFromBottom = false;
        let zeroLeftOneRight = false;
        let oneLeftZeroRight = false;
        let zeroTopOneBottom = false;
        let oneTopZeroBottom = false;
        let krock = false;
        const ajust = 10;
       
        for(let i = 0; i < numberOfPlayers; i++) {
             // Slumpar värde för startpossition
            let randomX = Math.round(Math.random() * 800);
            let randomY = Math.round(Math.random() * 800);
             // Skapar ett objekt i JS för players
            players[i] = {
                posX: randomX,
                posY: randomY,
                width: 50,
                height: 50,
                right: 0,
                bottom: 0,
                stegX: 0.5,
                stegY: 0.5,
                accelaration: 1,
            };
             // Skapar ett objekt i JS för skott
            oSkott[i] = {
                posX: 0,
                posY: 0,
                width: 0,
                height: 0,
                speedX: 5,
                speedY: 0.5,
                accelaration: 3,
                active: false,
            };
            skepp[i] = document.createElement("div");
            skott[i] = document.createElement("div");
            document.body.append(skepp[i]);
            document.body.append(skott[i]);
            skepp[i].textContent = `${i}`;
            skepp[i].style.width = players[i].width + "px";
            skepp[i].style.height = players[i].height + "px";
            skepp[i].style.backgroundColor = colors[i];
            skott[i].textContent = `*`;
            // Fångar händelser från tangenter
            document.addEventListener("keydown",(event) => {
                // Ökar/miskar hastigheten med accelerationsvärdet
                if (event.key === keyNames[i][0]) players[i].stegX += players[i].accelaration;
                if (event.key === keyNames[i][1]) players[i].stegX -= players[i].accelaration;
                if (event.key === keyNames[i][2]) players[i].stegY -= players[i].accelaration;
                if (event.key === keyNames[i][3]) players[i].stegY += players[i].accelaration;
                if (event.key === "0") oSkott[0].active = true;
                if (event.key === " ") oSkott[1].active = true;
                //inputs[0].value = players[0].stegX + " " + players[0].stegY;
            });
        }
        function kollaVar(obj){
            if (krock) {
                    if (bothComingFromRight && (players[0].posX < players[1].right) && (players[0].posX > players[1].right-ajust)) {
                        players[0].stegX = startHastighet;
                    } else if (bothComingFromRight && players[1].posX < players[0].right && (players[1].posX > players[0].right-ajust)) {
                        players[1].stegX = startHastighet;
                    } else if (bothComingFromLeft && players[1].right > players[0].posX && players[1].right < players[0].posX+ajust) {
                        players[1].stegX = -startHastighet;
                    } else if (bothComingFromLeft && players[0].right > players[1].posX && players[0].right < players[1].posX+ajust) {
                        players[0].stegX = -startHastighet;
                    } else if (zeroLeftOneRight && players[0].right > players[1].posX && players[0].right < players[1].posX+ajust) {
                        players[0].stegX = -startHastighet;
                        players[1].stegX = startHastighet;
                    } else if (oneLeftZeroRight && players[1].right > players[0].posX && players[1].right < players[0].posX+ajust) {
                        players[0].stegX = startHastighet;
                        players[1].stegX = -startHastighet;
                    } 
                    if (bothComingFromBottom && (players[0].posY < players[1].bottom) && (players[0].posY > players[1].bottom-ajust)) {
                        players[0].stegY = startHastighet;
                    } else if (bothComingFromBottom && (players[1].posY < players[0].bottom) && (players[1].posY > players[0].bottom-ajust)) {
                        players[1].stegY = startHastighet;
                    } else if (bothComingFromTop && players[1].bottom > players[0].posY && players[1].bottom < players[0].posY+ajust) {
                        players[1].stegY = -startHastighet;
                    } else if (bothComingFromTop && players[0].bottom > players[1].posY && players[0].bottom < players[1].posY+ajust) {
                        players[0].stegY = -startHastighet;
                    } else if (zeroTopOneBottom && players[0].bottom > players[1].posY && players[0].bottom < players[1].posY+ajust) {
                        players[0].stegY = -startHastighet;
                        players[1].stegY = startHastighet;
                    } else if (oneTopZeroBottom && players[1].bottom > players[0].posY && players[1].bottom < players[0].posY+ajust) {
                        players[0].stegY = startHastighet;
                        players[1].stegY = -startHastighet;
                    }
            }            
            inputs[1].value = window.innerHeight;
            /*inputs[2].value = `From top ${bothComingFromTop}`;
            inputs[3].value = `From bottom ${bothComingFromBottom}`;
            inputs[4].value = `zeroLeftOneRight ${zeroLeftOneRight}`;
            inputs[5].value = `zeroLeftOneRight ${zeroLeftOneRight}`;
            inputs[6].value = `zeroTopOneBottom ${zeroTopOneBottom}`;
            inputs[7].value = `oneTopZeroBottom ${oneTopZeroBottom}`;*/


        }
            // Ger objekten position utifrån värdena från händeserna
            const motor1 = setInterval(()=>{
                bothComingFromRight = players[0].stegX < 0 && players[1].stegX < 0;
                bothComingFromLeft = players[0].stegX > 0 && players[1].stegX > 0;
                bothComingFromTop = players[0].stegY > 0 && players[1].stegY > 0;
                bothComingFromBottom = players[0].stegY < 0 && players[1].stegY < 0;;
                zeroLeftOneRight = players[0].stegX > 0 && players[1].stegX < 0;
                oneLeftZeroRight = players[0].stegX < 0 && players[1].stegX > 0;
                zeroTopOneBottom = players[0].stegY > 0 && players[1].stegY < 0;
                oneTopZeroBottom = players[0].stegY < 0 && players[1].stegY > 0;

                krock = players[1].right > players[0].posX && 
                    players[1].bottom > players[0].posY &&
                    players[1].posX < players[0].right  && 
                    players[1].posY < players[0].bottom;
                inputs[0].value = krock;
                kollaVar();
                for(let i = 0; i < numberOfPlayers; i++) {
                    players[i].right = (players[i].posX + players[i].width)
                    players[i].bottom = (players[i].posY + players[i].height)
                    // posX ökar för varje anrop med hastighetsvärdet
                    if(players[i].right > window.innerWidth) {
                        players[i].stegX = -startHastighet;
                    } else if ((players[i].posX) < 1) {
                        //console.log(players[i].posX)
                        players[i].stegX = startHastighet;
                    }
                    if(players[i].bottom > window.innerHeight) {
                        players[i].stegY = -startHastighet;
                    } else if ((players[i].posY) < 1) {
                        //console.log(players[i].posY)
                        players[i].stegY = startHastighet;
                    }
                    
                    players[i].posX = players[i].posX + players[i].stegX;
                    players[i].posY = players[i].posY + players[i].stegY;

                    // style-objektet får ny possition
                    skepp[i].style.left = players[i].posX + "px";
                    skepp[i].style.top = players[i].posY + "px";
                    skott[i].style.left = oSkott[i].posX + "px";
                    skott[i].style.top = oSkott[i].posY + "px";

                    if (oSkott[i].active) {
                        if (oSkott[i].speedX > 0) {
                            oSkott[i].posX += oSkott[i].speedX + oSkott[i].accelaration;
                        } else if (oSkott[i].speedX < 0) {
                            oSkott[i].posX += oSkott[i].speedX - oSkott[i].accelaration;
                        }
                        oSkott[i].posY += oSkott[i].speedY;


                    } else {
                        oSkott[i].posX = players[i].posX + 10;
                        oSkott[i].posY = players[i].posY + 10;
                        oSkott[i].speedY = players[i].stegY;
                        oSkott[i].speedX = players[i].stegX;
                    }

                    

                    // Kontrollvärden
                    /*
                    inputs[0].value = oSkott[0].active;
                    inputs[1].value = oSkott[i].speedX;
                    inputs[2].value = oSkott[1].posX;
                    inputs[3].value = window.innerWidth;
                    inputs[4].value = window.innerHeight;
                    */
                    
                }
            }, 10)
        
    </script>
</head>
<body>
    <!--div id="skepp1">skepp 1</div>
    <div id="skepp2">skepp 2</div-->
    <input type="text">
    <input type="text">
    <input type="text">
    <input type="text">
    <input type="text">
    <input type="text">
    <input type="text">
    <input type="text">
</body>
</html>